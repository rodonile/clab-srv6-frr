name: frr-srv6
prefix: ""

topology:
  nodes:
    # CORE ROUTERS (ISIS-DOMAIN)
    frr1:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      exec:
        # Basic configs
        - sysctl -w net.vrf.strict_mode=1
        - ip link add lo1 type dummy
        - ip link set lo1 up
        # VRFs (for L3VPN)
        - ip link add dev client2 type vrf table 2
        - ip link set client2 up
        - ip link set dev eth4 master client2
      binds:
        - frr1/daemons:/etc/frr/daemons
        - frr1/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "545"
        graph-posY: "575"
        graph-groupLabelPos: bottom-center

    frr2:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      exec:
        # Basic configs
        - sysctl -w net.vrf.strict_mode=1
        - ip link add lo1 type dummy
        - ip link set lo1 up
      binds:
        - frr2/daemons:/etc/frr/daemons
        - frr2/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "665"
        graph-posY: "575"
        graph-groupLabelPos: bottom-center

    frr3:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      exec:
        # Basic configs
        - sysctl -w net.vrf.strict_mode=1
        - ip link add lo1 type dummy
        - ip link set lo1 up
        # VRFs (for L3VPN)
        - ip link add dev client1 type vrf table 1
        - ip link set client1 up
        - ip link set dev eth3 master client1
        # - ip link set dev eth5 master client1
        - ip link add dev client2 type vrf table 2
        - ip link set client2 up
        - ip link set dev eth4 master client2
        # Bridges (for L2VPN)
        - ip link add name br100 type bridge
        - ip link set dev br100 type bridge vlan_filtering 1
        - ip link set dev br100 up
        - ip link set dev eth5 master br100
        - ip link set dev eth5 up
      binds:
        - frr3/daemons:/etc/frr/daemons
        - frr3/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "485"
        graph-posY: "635"
        graph-groupLabelPos: bottom-center

    frr4:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      exec:
        # Basic configs
        - sysctl -w net.vrf.strict_mode=1
        - ip link add lo1 type dummy
        - ip link set lo1 up
      binds:
        - frr4/daemons:/etc/frr/daemons
        - frr4/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "545"
        graph-posY: "705"
        graph-groupLabelPos: bottom-center

    frr5:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      exec:
        # Basic configs
        - sysctl -w net.vrf.strict_mode=1
        - ip link add lo1 type dummy
        - ip link set lo1 up
        # VRFs (for L3VPN)
        - ip link add dev client1 type vrf table 1
        - ip link set client1 up
        - ip link set dev eth4 master client1
        # - ip link set dev eth5 master client1
        # Bridges (for L2VPN)
        - ip link add name br100 type bridge
        - ip link set dev br100 type bridge vlan_filtering 1
        - ip link set dev br100 up
        - ip link set dev eth5 master br100
        - ip link set dev eth5 up
      binds:
        - frr5/daemons:/etc/frr/daemons
        - frr5/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "665"
        graph-posY: "705"
        graph-groupLabelPos: bottom-center

    frr6:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      exec:
        # Basic configs
        - sysctl -w net.vrf.strict_mode=1
        - ip link add lo1 type dummy
        - ip link set lo1 up
        # VRFs (for L3VPN)
        - ip link add dev client1 type vrf table 1
        - ip link set client1 up
        - ip link set dev eth3 master client1
        # - ip link set dev eth5 master client1
        - ip link add dev client2 type vrf table 2
        - ip link set client2 up
        - ip link set dev eth4 master client2
        # Bridges (for L2VPN)
        - ip link add name br100 type bridge
        - ip link set dev br100 type bridge vlan_filtering 1
        - ip link set dev br100 up
        - ip link set dev eth5 master br100
        - ip link set dev eth5 up
      binds:
        - frr6/daemons:/etc/frr/daemons
        - frr6/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "745"
        graph-posY: "635"
        graph-groupLabelPos: bottom-center

    # CE ROUTERS (CLIENT 1)
    frr_c1_r1:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      binds:
        - frr_c1_r1/daemons:/etc/frr/daemons
        - frr_c1_r1/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "425"
        graph-posY: "545"
        graph-groupLabelPos: bottom-center

    frr_c1_r2:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      binds:
        - frr_c1_r2/daemons:/etc/frr/daemons
        - frr_c1_r2/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "785"
        graph-posY: "545"
        graph-groupLabelPos: bottom-center

    frr_c1_r3:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      binds:
        - frr_c1_r3/daemons:/etc/frr/daemons
        - frr_c1_r3/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "615"
        graph-posY: "755"
        graph-groupLabelPos: bottom-center

    # CE ROUTERS (CLIENT 2)
    frr_c2_r1:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      binds:
        - frr_c2_r1/daemons:/etc/frr/daemons
        - frr_c2_r1/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "435"
        graph-posY: "725"
        graph-groupLabelPos: bottom-center

    frr_c2_r2:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      binds:
        - frr_c2_r2/daemons:/etc/frr/daemons
        - frr_c2_r2/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "785"
        graph-posY: "715"
        graph-groupLabelPos: bottom-center

    frr_c2_r3:
      kind: linux
      image: quay.io/frrouting/frr:10.2.3
      binds:
        - frr_c2_r3/daemons:/etc/frr/daemons
        - frr_c2_r3/frr.conf:/etc/frr/frr.conf
      labels:
        graph-posX: "605"
        graph-posY: "525"
        graph-groupLabelPos: bottom-center

    # LINUX PCs (CLIENT1)
    PC11:
      kind: linux
      image: network-multitool-leo:v1.1
      exec:
        - ip link set eth1 up
        - ip addr add 192.168.11.2/24 dev eth1
        - ip -6 addr add c1:1:feed::2/64 dev eth1
        - ip route add 192.168.0.0/16 via 192.168.11.1 dev eth1
        - ip -6 route add c1:2:feed::/64 via c1:1:feed::1 dev eth1
        - ip -6 route add c1:3:feed::/64 via c1:1:feed::1 dev eth1
        - ip link set eth2 up
        - ip addr add 100.100.100.11/24 dev eth2
        - ip -6 addr add abba::11/64 dev eth2
      labels:
        graph-posX: "425"
        graph-posY: "455"
        graph-groupLabelPos: bottom-center
    PC12:
      kind: linux
      image: network-multitool-leo:v1.1
      exec:
        - ip link set eth1 up
        - ip addr add 192.168.12.2/24 dev eth1
        - ip -6 addr add c1:2:feed::2/64 dev eth1
        - ip route add 192.168.0.0/16 via 192.168.12.1 dev eth1
        - ip -6 route add c1:1:feed::/64 via c1:2:feed::1 dev eth1
        - ip -6 route add c1:3:feed::/64 via c1:2:feed::1 dev eth1
        - ip link set eth2 up
        - ip addr add 100.100.100.12/24 dev eth2
        - ip -6 addr add abba::12/64 dev eth2
      labels:
        graph-posX: "785"
        graph-posY: "455"
        graph-groupLabelPos: bottom-center

    PC13:
      kind: linux
      image: network-multitool-leo:v1.1
      exec:
        - ip link set eth1 up
        - ip addr add 192.168.13.2/24 dev eth1
        - ip -6 addr add c1:3:feed::2/64 dev eth1
        - ip route add 192.168.0.0/16 via 192.168.13.1 dev eth1
        - ip -6 route add c1:1:feed::/64 via c1:3:feed::1 dev eth1
        - ip -6 route add c1:2:feed::/64 via c1:3:feed::1 dev eth1
        - ip link set eth2 up
        - ip addr add 100.100.100.13/24 dev eth2
        - ip -6 addr add abba::13/64 dev eth2
      labels:
        graph-posX: "615"
        graph-posY: "825"
        graph-groupLabelPos: bottom-center

    # LINUX PCs (CLIENT2)
    PC21:
      kind: linux
      image: network-multitool-leo:v1.1
      exec:
        - ip link set eth1 up
        - ip addr add 192.168.21.2/24 dev eth1
        - ip -6 addr add c2:1:feed::2/64 dev eth1
        - ip route add 192.168.0.0/16 via 192.168.21.1 dev eth1
        - ip -6 route add c2:2:feed::/64 via c2:1:feed::1 dev eth1
        - ip -6 route add c2:3:feed::/64 via c2:1:feed::1 dev eth1
      labels:
        graph-posX: "435"
        graph-posY: "825"
        graph-groupLabelPos: bottom-center

    PC22:
      kind: linux
      image: network-multitool-leo:v1.1
      exec:
        - ip link set eth1 up
        - ip addr add 192.168.22.2/24 dev eth1
        - ip -6 addr add c2:2:feed::2/64 dev eth1
        - ip route add 192.168.0.0/16 via 192.168.22.1 dev eth1
        - ip -6 route add c2:1:feed::/64 via c2:2:feed::1 dev eth1
        - ip -6 route add c2:3:feed::/64 via c2:2:feed::1 dev eth1
      labels:
        graph-posX: "785"
        graph-posY: "825"
        graph-groupLabelPos: bottom-center

    PC23:
      kind: linux
      image: network-multitool-leo:v1.1
      exec:
        - ip link set eth1 up
        - ip addr add 192.168.23.2/24 dev eth1
        - ip -6 addr add c2:3:feed::2/64 dev eth1
        - ip route add 192.168.0.0/16 via 192.168.23.1 dev eth1
        - ip -6 route add c2:1:feed::/64 via c2:3:feed::1 dev eth1
        - ip -6 route add c2:2:feed::/64 via c2:3:feed::1 dev eth1
      labels:
        graph-posX: "605"
        graph-posY: "455"
        graph-groupLabelPos: bottom-center

  links:
    - endpoints: [ "frr3:eth2", "frr1:eth3" ]
    - endpoints: [ "frr3:eth1", "frr4:eth1" ]
    - endpoints: [ "frr1:eth1", "frr2:eth1" ]
    - endpoints: [ "frr1:eth2", "frr5:eth2" ]
    - endpoints: [ "frr4:eth2", "frr5:eth3" ]
    - endpoints: [ "frr2:eth2", "frr6:eth2" ]
    - endpoints: [ "frr5:eth1", "frr6:eth1" ]
    - endpoints: [ "frr_c1_r1:eth1", "frr3:eth3" ]
    - endpoints: [ "frr_c1_r2:eth1", "frr6:eth3" ]
    - endpoints: [ "frr_c1_r3:eth1", "frr5:eth4" ]
    - endpoints: [ "frr_c2_r1:eth1", "frr3:eth4" ]
    - endpoints: [ "frr_c2_r2:eth1", "frr6:eth4" ]
    - endpoints: [ "frr_c2_r3:eth1", "frr1:eth4" ]
    - endpoints: [ "frr_c1_r1:eth2", "PC11:eth1" ]
    - endpoints: [ "frr_c1_r2:eth2", "PC12:eth1" ]
    - endpoints: [ "frr_c1_r3:eth2", "PC13:eth1" ]
    - endpoints: [ "frr_c2_r1:eth2", "PC21:eth1" ]
    - endpoints: [ "frr_c2_r2:eth2", "PC22:eth1" ]
    - endpoints: [ "frr_c2_r3:eth2", "PC23:eth1" ]
    - endpoints: [ "frr_c1_r1:eth3", "frr3:eth5" ]
    - endpoints: [ "frr_c1_r2:eth3", "frr6:eth5" ]
    - endpoints: [ "frr_c1_r3:eth3", "frr5:eth5" ]
    - endpoints: [ "frr_c1_r1:eth4", "PC11:eth2" ]
    - endpoints: [ "frr_c1_r2:eth4", "PC12:eth2" ]
    - endpoints: [ "frr_c1_r3:eth4", "PC13:eth2" ]
